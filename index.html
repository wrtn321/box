<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¼ì´ì¼</title>
    <style>
        :root {
            --primary-color: #4f46e5; --primary-light-color: #e0e7ff; --border-color: #ddd;
            --background-light: #f4f4f4; --background-white: #fff; --text-dark: #333; --text-light: #666;
            --green-color: #16a34a; --red-color: #dc2626;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; background-color: var(--background-light); color: var(--text-dark); display: flex; flex-direction: column; height: 100vh; }
        .header { display: flex; align-items: center; gap: 10px; background-color: var(--background-white); padding: 10px 15px; border-bottom: 1px solid var(--border-color); box-shadow: 0 2px 4px rgba(0,0,0,0.05); z-index: 10; }
        #search-input { flex-grow: 1; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
        .settings-menu { position: relative; }
        #settings-button { background: none; border: none; font-size: 24px; cursor: pointer; padding: 5px; line-height: 1; color: var(--text-light); }
        #settings-dropdown { display: none; position: absolute; right: 0; top: 100%; background-color: var(--background-white); border: 1px solid var(--border-color); border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 100; min-width: 200px; }
        #settings-dropdown button { display: block; width: 100%; padding: 12px 15px; border: none; background: none; text-align: left; cursor: pointer; font-size: 14px; }
        #settings-dropdown button:hover { background-color: #f0f0f0; }
        #delete-tab-button { color: var(--red-color); }
        .tabs-container { padding: 0 10px; background-color: var(--background-white); border-bottom: 1px solid var(--border-color); display: flex; align-items: center; gap: 5px; overflow-x: auto; }
        .tab { padding: 12px 15px; cursor: pointer; border-bottom: 3px solid transparent; font-size: 15px; white-space: nowrap; }
        .tab.active { color: var(--primary-color); border-bottom-color: var(--primary-color); font-weight: 600; }
        #add-file-tab { font-size: 24px; font-weight: bold; color: var(--primary-color); padding: 5px 15px; cursor: pointer; border-radius: 5px; }
        #add-file-tab:hover { background-color: #f0f0f0; }
        .main-container { display: flex; flex: 1; overflow: hidden; }
        #sidebar { width: 320px; background-color: var(--background-white); border-right: 1px solid var(--border-color); overflow-y: auto; flex-shrink: 0; }
        .sidebar-item { padding: 15px 20px; cursor: pointer; border-bottom: 1px solid #eee; font-size: 15px; overflow: hidden; text-overflow: ellipsis; }
        .sidebar-item:hover { background-color: #f0f0f0; }
        .sidebar-item.active { background-color: var(--primary-light-color); font-weight: 600; color: var(--primary-color); border-right: 3px solid var(--primary-color); }
        #content-area { flex: 1; padding: 25px; overflow-y: auto; background-color: #fafafa; }
        #content-wrapper, #edit-form { display: none; }
        #content-wrapper.visible, #edit-form.visible { display: block; }
        .actions-container { margin-bottom: 20px; display: flex; align-items: center; gap: 15px; flex-wrap: wrap; }
        .action-button { background-color: var(--primary-color); color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-size: 14px; }
        #back-to-list-button { display: none; background-color: var(--text-light); }
        #char-count { font-size: 14px; color: var(--text-light); background-color: #eef2ff; padding: 8px 12px; border-radius: 5px; }
        #content-title { font-size: 24px; font-weight: bold; margin: 0; }
        #content-body { background-color: var(--background-white); border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; white-space: pre-wrap; word-wrap: break-word; font-size: 16px; line-height: 1.7; margin-top: 15px; }
        .image-container { margin-top: 20px; display: flex; flex-direction: column; gap: 10px; }
        .image-container img { width: 100%; height: auto; object-fit: cover; border-radius: 8px; border: 1px solid var(--border-color); }
        #edit-form label { font-size: 14px; font-weight: 600; color: #555; display: block; margin-bottom: 5px; }
        #edit-form input, #edit-form textarea { width: 100%; box-sizing: border-box; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 5px; margin-bottom: 15px; font-family: inherit; }
        #edit-content-input { min-height: 250px; resize: vertical; line-height: 1.7; }
        #edit-image-urls-textarea { min-height: 80px; resize: vertical; }
        .file-loader { padding: 40px 20px; text-align: center; }
        .file-loader-label { display: inline-block; background: var(--primary-color); color: white; padding: 15px 30px; border-radius: 8px; cursor: pointer; margin-bottom: 15px; font-size: 16px; }
        #file-input { display: none; }
        @media (max-width: 768px) {
            .main-container.content-mode #sidebar { display: none; }
            .main-container:not(.content-mode) #content-area { display: none; }
            #sidebar, #content-area { width: 100%; border-right: none; }
            #back-to-list-button { display: inline-block; }
        }
    </style>
</head>
<body>
    <header class="header">
        <input type="text" id="search-input" placeholder="íŒŒì¼ì„ ë¶ˆëŸ¬ì™€ì£¼ì„¸ìš”..." disabled>
        <div class="settings-menu" id="settings-menu" style="display: none;">
            <button id="settings-button" title="ì„¤ì •">âš™ï¸</button>
            <div id="settings-dropdown">
                <button id="add-note-button">â• ìƒˆ ë…¸íŠ¸ ì¶”ê°€</button>
                <button id="add-tab-button">ğŸ“‚ ìƒˆ íƒ­ ì¶”ê°€</button>
                <button id="export-tab-button">í˜„ì¬ íƒ­ ë‹¤ìš´ë¡œë“œ (.json)</button>
                <button id="delete-tab-button">í˜„ì¬ íƒ­ ì‚­ì œ</button>
            </div>
        </div>
    </header>

    <div class="tabs-container" id="tabs-container"></div>

    <div class="main-container" id="main-container">
        <aside id="sidebar"></aside>
        <main id="content-area">
            <div id="initial-loader" class="file-loader">
                <label for="file-input" class="file-loader-label">JSON íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°</label>
                <input type="file" id="file-input" accept=".json" multiple>
                <p>json íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.</p>
            </div>
            <div id="content-wrapper">
                 <div class="actions-container">
                    <button id="back-to-list-button" class="action-button">ëª©ë¡</button>
                    <button id="copy-button" class="action-button">copy</button>
                    <button id="edit-button" class="action-button" style="background-color: var(--green-color);">edit</button>
                    <span id="char-count"></span>
                </div>
                <h2 id="content-title"></h2>
                <pre id="content-body"></pre>
                <div id="image-container" class="image-container"></div>
            </div>
            <div id="edit-form">
                <label for="edit-title-input">ì œëª©</label>
                <input type="text" id="edit-title-input">
                
                <label for="edit-content-input">ë‚´ìš©</label>
                <textarea id="edit-content-input"></textarea>
                
                <label for="edit-image-urls-textarea">ì´ë¯¸ì§€ URL (í•œ ì¤„ì— í•˜ë‚˜ì”©)</label>
                <textarea id="edit-image-urls-textarea" placeholder="https://example.com/image1.png&#10;https://example.com/image2.jpg"></textarea>

                <div class="actions-container">
                    <button id="save-button" class="action-button" style="background-color: var(--green-color);">ì €ì¥</button>
                    <button id="cancel-button" class="action-button" style="background-color: var(--text-light);">ì·¨ì†Œ</button>
                </div>
            </div>
        </main>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const LOCAL_STORAGE_KEY = 'privateNotesData';
        const getEl = (id) => document.getElementById(id);
        
        // DOM Elements
        const fileInput = getEl('file-input'), searchInput = getEl('search-input'), tabsContainer = getEl('tabs-container');
        const sidebar = getEl('sidebar'), mainContainer = getEl('main-container'), initialLoader = getEl('initial-loader');
        const contentWrapper = getEl('content-wrapper'), imageContainer = getEl('image-container'), contentTitle = getEl('content-title');
        const contentBody = getEl('content-body'), copyButton = getEl('copy-button'), charCount = getEl('char-count');
        const backToListButton = getEl('back-to-list-button'), editButton = getEl('edit-button');
        const editForm = getEl('edit-form'), editTitleInput = getEl('edit-title-input'), editContentInput = getEl('edit-content-input'), editImageUrlsTextarea = getEl('edit-image-urls-textarea');
        const saveButton = getEl('save-button'), cancelButton = getEl('cancel-button');
        const settingsMenu = getEl('settings-menu'), settingsButton = getEl('settings-button'), settingsDropdown = getEl('settings-dropdown');
        const addTabButton = getEl('add-tab-button'), addNoteButton = getEl('add-note-button'), exportTabButton = getEl('export-tab-button'), deleteTabButton = getEl('delete-tab-button');
        
        let loadedData = {}, activeTab = null, currentNote = null, editingNoteIndex = null;

        const saveDataToLocal = () => localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(loadedData));
        const loadDataFromLocal = () => {
            const savedData = localStorage.getItem(LOCAL_STORAGE_KEY);
            if (savedData) loadedData = JSON.parse(savedData);
            const filenames = Object.keys(loadedData);
            tabsContainer.innerHTML = '';
            createAddFileTab();
            if (filenames.length > 0) {
                setupUIForLoadedData();
                filenames.forEach(createTab);
                switchTab(filenames[0]);
            }
        };

        const setupUIForLoadedData = () => {
            initialLoader.style.display = 'none';
            settingsMenu.style.display = 'block';
            searchInput.disabled = false;
            searchInput.placeholder = 'ì œëª© ë˜ëŠ” ë‚´ìš©ìœ¼ë¡œ ê²€ìƒ‰...';
        };

        const createAddFileTab = () => {
            const addTab = document.createElement('div');
            addTab.id = 'add-file-tab'; addTab.textContent = '+'; addTab.title = 'íŒŒì¼ ì¶”ê°€í•˜ê¸°';
            addTab.onclick = () => fileInput.click();
            tabsContainer.appendChild(addTab);
        };

        const switchViewMode = (mode) => {
            contentWrapper.classList.toggle('visible', mode === 'view');
            editForm.classList.toggle('visible', mode === 'edit');
        };

        const handleFileSelect = (event) => {
            const files = Array.from(event.target.files);
            if (files.length === 0) return;
            setupUIForLoadedData();
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = e => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (!Array.isArray(data)) throw new Error('JSON is not an array.');
                        const filename = file.name;
                        loadedData[filename] = data;
                        if (!document.querySelector(`.tab[data-filename="${filename}"]`)) createTab(filename);
                        saveDataToLocal();
                        switchTab(filename);
                    } catch (err) { alert(`'${file.name}' ì²˜ë¦¬ ì˜¤ë¥˜: ìœ íš¨í•œ JSON ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤.`); }
                };
                reader.readAsText(file);
            });
            fileInput.value = '';
        };

        const createTab = (filename) => {
            const tabName = filename.replace('.json', '');
            const tab = document.createElement('div');
            tab.className = 'tab'; tab.textContent = tabName; tab.dataset.filename = filename;
            tab.addEventListener('click', () => switchTab(filename));
            tabsContainer.insertBefore(tab, getEl('add-file-tab'));
        };

        const switchTab = (filename) => {
            activeTab = filename;
            document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.filename === filename));
            populateSidebar(loadedData[filename] || []);
            switchViewMode('none');
            getEl('content-wrapper').classList.remove('visible');
            showSidebarView();
        };

        const populateSidebar = (notes) => {
            sidebar.innerHTML = '';
            notes.forEach((note, index) => {
                const item = document.createElement('div');
                item.className = 'sidebar-item'; item.textContent = note.title;
                item.addEventListener('click', () => displayContent(note, item, index));
                sidebar.appendChild(item);
            });
        };

        const displayContent = (note, clickedItem, index) => {
            currentNote = note; editingNoteIndex = index;
            document.querySelectorAll('.sidebar-item.active').forEach(i => i.classList.remove('active'));
            clickedItem.classList.add('active');

            imageContainer.innerHTML = '';
            if (note.imageUrls && note.imageUrls.length > 0) {
                note.imageUrls.forEach(url => {
                    const img = document.createElement('img');
                    img.src = url;
                    img.alt = note.title + ' ì´ë¯¸ì§€';
                    imageContainer.appendChild(img);
                });
                imageContainer.style.display = 'grid';
            } else {
                imageContainer.style.display = 'none';
            }

            contentTitle.textContent = note.title;
            contentBody.textContent = note.content;
            charCount.textContent = `${note.content?.length || 0}ì`;
            switchViewMode('view');
            showContentView();
        };
        
        const enterEditMode = () => {
            if (!currentNote) return;
            editTitleInput.value = currentNote.title;
            editContentInput.value = currentNote.content;
            editImageUrlsTextarea.value = (currentNote.imageUrls || []).join('\n');
            switchViewMode('edit');
        };

        const saveNote = () => {
            const imageUrls = editImageUrlsTextarea.value.trim().split('\n').filter(url => url.trim() !== '');
            const updatedNote = {
                ...currentNote,
                title: editTitleInput.value,
                content: editContentInput.value,
            };

            if (imageUrls.length > 0) {
                updatedNote.imageUrls = imageUrls;
            } else {
                delete updatedNote.imageUrls;
            }

            loadedData[activeTab][editingNoteIndex] = updatedNote;
            saveDataToLocal();
            currentNote = updatedNote;
            populateSidebar(loadedData[activeTab]);
            displayContent(currentNote, document.querySelector(`.sidebar-item:nth-child(${editingNoteIndex + 1})`), editingNoteIndex);
        };

        const addNewNote = () => {
            if (!activeTab) return;
            settingsDropdown.style.display = 'none';
            const newNote = { title: "ìƒˆ ë…¸íŠ¸", content: "" };
            if(!loadedData[activeTab]) loadedData[activeTab] = [];
            loadedData[activeTab].unshift(newNote);
            saveDataToLocal();
            populateSidebar(loadedData[activeTab]);
            displayContent(newNote, document.querySelector('.sidebar-item'), 0);
            enterEditMode();
        };

        const handleSearch = (e) => {
            if (!activeTab) return;
            const searchTerm = e.target.value.toLowerCase();
            const filteredNotes = (loadedData[activeTab] || []).filter(note =>
                (note.title && note.title.toLowerCase().includes(searchTerm)) ||
                (note.content && note.content.toLowerCase().includes(searchTerm))
            );
            populateSidebar(filteredNotes);
        };
        
        const addNewTab = () => {
            settingsDropdown.style.display = 'none';
            const tabName = prompt("ìƒˆ íƒ­ì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:");
            if (!tabName || tabName.trim() === '') return;
            const filename = tabName.trim() + '.json';
            if (loadedData[filename]) {
                alert("ì˜¤ë¥˜: ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íƒ­ ì´ë¦„ì…ë‹ˆë‹¤.");
                return;
            }
            loadedData[filename] = [];
            saveDataToLocal();
            createTab(filename);
            switchTab(filename);
        };

        const exportTabData = () => {
            if (!activeTab) return;
            const data = loadedData[activeTab];
            const jsonString = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = activeTab;
            document.body.appendChild(a); a.click();
            document.body.removeChild(a); URL.revokeObjectURL(url);
        };
        const deleteCurrentTab = () => {
            if (!activeTab || !confirm(`'${activeTab.replace('.json','')}' íƒ­ì„ ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            delete loadedData[activeTab];
            saveDataToLocal();
            location.reload();
        };
        
        const showContentView = () => mainContainer.classList.add('content-mode');
        const showSidebarView = () => mainContainer.classList.remove('content-mode');

        // Event Listeners
        fileInput.addEventListener('change', handleFileSelect);
        searchInput.addEventListener('input', handleSearch);
        backToListButton.addEventListener('click', showSidebarView);
        addTabButton.addEventListener('click', addNewTab);
        addNoteButton.addEventListener('click', addNewNote);
        editButton.addEventListener('click', enterEditMode);
        saveButton.addEventListener('click', saveNote);
        cancelButton.addEventListener('click', () => switchViewMode('view'));
        settingsButton.addEventListener('click', (e) => { e.stopPropagation(); settingsDropdown.style.display = settingsDropdown.style.display === 'block' ? 'none' : 'block'; });
        document.addEventListener('click', () => { settingsDropdown.style.display = 'none'; });
        exportTabButton.addEventListener('click', exportTabData);
        deleteTabButton.addEventListener('click', deleteCurrentTab);
        copyButton.addEventListener('click', () => {
            if (!currentNote || !currentNote.content) return;
            navigator.clipboard.writeText(currentNote.content).then(() => {
                copyButton.textContent = 'copied!'; setTimeout(() => { copyButton.textContent = 'copy'; }, 1500);
            });
        });
        
        loadDataFromLocal();
        // --- [NEW] Swipe Back Gesture for Mobile ---
function initSwipeBackGesture() {
    // ì„¤ì •ê°’: ì´ ê°’ì„ ì¡°ì ˆí•˜ì—¬ ë¯¼ê°ë„ë¥¼ ë°”ê¿€ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    const SWIPE_EDGE_ZONE = 50; // ìŠ¤ì™€ì´í”„ê°€ ì‹œì‘ë˜ì–´ì•¼ í•˜ëŠ” í™”ë©´ ì™¼ìª½ ê°€ì¥ìë¦¬ ì˜ì—­ (px)
    const SWIPE_THRESHOLD = 80; // ìŠ¤ì™€ì´í”„ë¡œ ì¸ì •ë˜ê¸° ìœ„í•œ ìµœì†Œí•œì˜ ê°€ë¡œ ì´ë™ ê±°ë¦¬ (px)

    let touchStartX = 0;
    let touchStartY = 0;
    let isSwiping = false;

    // ì œìŠ¤ì²˜ëŠ” ì½˜í…ì¸  ì˜ì—­ì—ì„œë§Œ ë™ì‘í•˜ë„ë¡ ì„¤ì •
    const contentArea = getEl('content-area');

    contentArea.addEventListener('touchstart', (e) => {
        // ë©€í‹°í„°ì¹˜(ë‘ ì†ê°€ë½ ì´ìƒ)ëŠ” ë¬´ì‹œ
        if (e.touches.length > 1) return;

        // í™”ë©´ì´ ì½˜í…ì¸  ë³´ê¸° ëª¨ë“œì¼ ë•Œë§Œ ì œìŠ¤ì²˜ë¥¼ ê°ì§€
        if (mainContainer.classList.contains('content-mode')) {
            const startX = e.touches[0].clientX;
            // ìŠ¤ì™€ì´í”„ê°€ ì™¼ìª½ ê°€ì¥ìë¦¬ ì˜ì—­ì—ì„œ ì‹œì‘ë˜ì—ˆëŠ”ì§€ í™•ì¸
            if (startX < SWIPE_EDGE_ZONE) {
                touchStartX = startX;
                touchStartY = e.touches[0].clientY;
                isSwiping = true;
            }
        }
    });

    contentArea.addEventListener('touchmove', (e) => {
        if (!isSwiping) return;

        const deltaX = e.touches[0].clientX - touchStartX;
        const deltaY = e.touches[0].clientY - touchStartY;

        // ìœ„ì•„ë˜ ìŠ¤í¬ë¡¤ê³¼ ì¶©ëŒí•˜ì§€ ì•Šë„ë¡, ìˆ˜í‰ ì›€ì§ì„ì´ ìˆ˜ì§ ì›€ì§ì„ë³´ë‹¤ í´ ë•Œë§Œ ìŠ¤ì™€ì´í”„ë¡œ ê°„ì£¼
        if (Math.abs(deltaX) < Math.abs(deltaY)) {
            isSwiping = false; // ìˆ˜ì§ ìŠ¤í¬ë¡¤ë¡œ íŒë‹¨í•˜ê³  ìŠ¤ì™€ì´í”„ ì·¨ì†Œ
        }
    });

    contentArea.addEventListener('touchend', (e) => {
        if (!isSwiping) return;
        
        isSwiping = false;
        const touchEndX = e.changedTouches[0].clientX;
        const swipeDistance = touchEndX - touchStartX;

        // ì¶©ë¶„í•œ ê±°ë¦¬ë¥¼ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ìŠ¤ì™€ì´í”„ í–ˆëŠ”ì§€ í™•ì¸
        if (swipeDistance > SWIPE_THRESHOLD) {
            showSidebarView(); // ê¸°ì¡´ì— ë§Œë“¤ì–´ë‘” 'ëª©ë¡ ë³´ê¸°' í•¨ìˆ˜ë¥¼ í˜¸ì¶œ
        }
    });
}
    });
    </script>
</body>
</html>