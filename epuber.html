<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EPUB ë·°ì–´</title>
    <!-- E-Book ë·°ì–´ë¥¼ ìœ„í•œ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬(Epub.js) ë¡œë“œ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.5/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/epubjs/dist/epub.min.js"></script>

    <style>
        /* --- í˜ì´ì§€ ì „ì²´ ìŠ¤íƒ€ì¼ --- */
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            height: 100vh;
        }

        /* --- ìƒë‹¨ ì»¨íŠ¸ë¡¤ ì˜ì—­ --- */
        .controls {
            padding: 15px;
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            width: 100%;
            text-align: center;
            box-sizing: border-box;
        }
        
        #upload-label {
            display: inline-block;
            padding: 8px 15px;
            background-color: #007bff;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        #book-upload {
            display: none; /* ì‹¤ì œ íŒŒì¼ ë²„íŠ¼ì€ ìˆ¨ê¹€ */
        }
        
        .filename {
            margin-left: 15px;
            font-style: italic;
            color: #555;
        }

        /* --- ì±…ì´ í‘œì‹œë  ë·°ì–´ ì˜ì—­ --- */
        #viewer-container {
            width: 100%;
            max-width: 800px; /* ì±… ìµœëŒ€ ë„ˆë¹„ */
            flex-grow: 1;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            margin: 20px 0;
            background-color: white;
        }
        
        #viewer {
            height: 100%;
        }

        /* --- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ì˜ì—­ --- */
        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 800px;
            padding: 10px 20px;
            box-sizing: border-box;
            background-color: #fff;
            margin-bottom: 10px;
        }
        
        .nav-button {
            padding: 10px 20px;
            border: none;
            background-color: #333;
            color: white;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .nav-button:hover {
            background-color: #555;
        }

        #location {
            font-size: 14px;
            color: #333;
        }
    </style>
</head>
<body>

    <!-- 1. ìƒë‹¨ ì»¨íŠ¸ë¡¤ ì˜ì—­ -->
    <div class="controls">
        <label for="book-upload" id="upload-label">ğŸ¦Š EPUB íŒŒì¼ ì„ íƒ</label>
        <input type="file" id="book-upload" accept=".epub">
        <span class="filename" id="filename-display">ì„ íƒëœ íŒŒì¼ ì—†ìŒ</span>
    </div>

    <!-- 2. ì±… ë‚´ìš©ì´ ë‚˜íƒ€ë‚  ì˜ì—­ -->
    <div id="viewer-container">
        <div id="viewer"></div>
    </div>
    
    <!-- 3. í˜ì´ì§€ ë„˜ê¹€ ë²„íŠ¼ ì˜ì—­ -->
    <div class="navigation">
        <button id="prev" class="nav-button">â—€ ì´ì „</button>
        <div id="location"></div>
        <button id="next" class="nav-button">ë‹¤ìŒ â–¶</button>
    </div>

    <script>
        // --- E-Book ë·°ì–´ ë¡œì§ ---
        
        const fileInput = document.getElementById('book-upload');
        const filenameDisplay = document.getElementById('filename-display');
        let book = null;
        let rendition = null;

        // íŒŒì¼ì´ ì„ íƒë˜ì—ˆì„ ë•Œ ì‹¤í–‰ë  í•¨ìˆ˜
        fileInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                // ê¸°ì¡´ì— ì—´ë ¤ìˆë˜ ì±…ì´ ìˆë‹¤ë©´ ì œê±°
                if (book) {
                    book.destroy();
                }
                
                filenameDisplay.textContent = file.name; // íŒŒì¼ ì´ë¦„ í‘œì‹œ
                
                // Epub.jsë¡œ ì±… ë¡œë“œ
                book = ePub(file.path || URL.createObjectURL(file));

                // ë·°ì–´ ì˜ì—­ì— ì±… ë Œë”ë§
                rendition = book.renderTo("viewer", {
                    width: "100%",
                    height: "100%",
                    // spread: "auto" // ì–‘ë©´ ë³´ê¸° (í•„ìš”ì‹œ ì£¼ì„ í•´ì œ)
                });

                // ì²« í˜ì´ì§€ í‘œì‹œ
                rendition.display();

                // í˜ì´ì§€ê°€ ë°”ë€” ë•Œë§ˆë‹¤ ìœ„ì¹˜ ì •ë³´ ì—…ë°ì´íŠ¸
                rendition.on("relocated", function(location) {
                    const currentPage = location.start.location;
                    const totalPages = book.locations.total;
                    const percentage = Math.floor(book.locations.percentageFromCfi(location.start.cfi) * 100);
                    document.getElementById('location').textContent = `${percentage}%`;
                });
            }
        });

        // ì´ì „/ë‹¤ìŒ ë²„íŠ¼ ê¸°ëŠ¥
        const prevButton = document.getElementById('prev');
        const nextButton = document.getElementById('next');

        prevButton.addEventListener('click', function() {
            if (rendition) {
                rendition.prev();
            }
        });

        nextButton.addEventListener('click', function() {
            if (rendition) {
                rendition.next();
            }
        });

        // í‚¤ë³´ë“œ í™”ì‚´í‘œë¡œ í˜ì´ì§€ ë„˜ê¸°ê¸°
        document.addEventListener('keydown', function(event) {
            if (rendition) {
                if (event.key === 'ArrowLeft') {
                    rendition.prev();
                } else if (event.key === 'ArrowRight') {
                    rendition.next();
                }
            }
        });

    </script>
</body>
</html>
